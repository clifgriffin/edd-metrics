!function(r,n,t,e){var o={init:function(){o.compare_temp_2=r.eddMetrics.compare_string_2,o.revenue=r.eddMetrics.revenue,o.downloads=r.eddMetrics.downloads,o.doCal()},doCal:function(){new Calendar({element:t(".metrics-datepicker"),presets:[{label:"Last 30 days",start:moment().subtract(29,"days"),end:moment()},{label:"This month",start:moment().startOf("month"),end:moment().endOf("month")},{label:"Last month",start:moment().subtract(1,"month").startOf("month"),end:moment().subtract(1,"month").endOf("month")},{label:"Last 7 days",start:moment().subtract(6,"days"),end:moment()},{label:"Last 3 months",start:moment(this.latest_date).subtract(3,"month").startOf("month"),end:moment(this.latest_date).subtract(1,"month").endOf("month")}],earliest_date:"January 1, 2006",latest_date:moment(),start_date:moment().subtract(29,"days"),end_date:moment(),callback:o.callback}).calendarSaveDates()},callback:function(){var e={action:"metrics_batch_1",start:moment(this.start_date).format("LL"),end:moment(this.end_date).format("LL")},a='<div id="circleG"><div id="circleG_1" class="circleG"></div><div id="circleG_2" class="circleG"></div><div id="circleG_3" class="circleG"></div></div>';t(".edd-metrics-box h2").html(a),t(".edd-metrics-box .bottom-text span").html("").removeClass(),t(this.element[0]).hasClass("metrics-detail")?(t(".edd-metrics-chart-wrapper").append(a),t.post(r.ajaxurl,e,o.detailResponse).then(function(){e.action="metrics_batch_2",t.post(r.ajaxurl,e,o.detailResponse_2)}).fail(function(){console.warn("ajax error")})):t.post(r.ajaxurl,e,o.dashResponse).then(function(){e.action="metrics_batch_2",t.post(r.ajaxurl,e,o.batch2response)}).fail(function(){console.warn("ajax error")})},dashResponse:function(e){var a=JSON.parse(e),s=r.eddMetrics.compare_string+" "+a.dates.num_days+" "+r.eddMetrics.days;t("#revenue").html(a.earnings.total),t("#revenue-compare").addClass(a.earnings.compare.classes),t("#revenue-compare span").html(a.earnings.compare.percentage+s).removeClass().addClass(a.earnings.compare.classes),t("#sales").html(a.sales.count),t("#sales-compare").addClass(a.sales.compare.classes),t("#sales-compare span").html(a.sales.compare.percentage+s).removeClass().addClass(a.sales.compare.classes),t("#avgpercust").html(a.earnings.avgpercust.total),t("#avgpercust-compare").addClass(a.earnings.avgpercust.compare.classes),t("#avgpercust-compare span").html(a.earnings.avgpercust.compare.percentage+s).removeClass().addClass(a.earnings.avgpercust.compare.classes),t("#refunds").html(a.earnings.refunds.count),t("#refund-amount").html(a.earnings.refunds.losses),t("#refunds-compare").addClass(a.earnings.refunds.compare.classes),t("#refunds-compare span").html(a.earnings.refunds.compare.percentage+s).removeClass().addClass(a.earnings.refunds.compare.classes),o.doLineChart(a.lineChart)},batch2response:function(e){var a=JSON.parse(e),s=r.eddMetrics.compare_string+" "+a.dates.num_days+" "+r.eddMetrics.days;t("#earnings-today").html(a.earnings.detail.today),t("#renewals").length&&(t("#renewals").html(a.renewals.count),t("#renewal-amount").html(a.renewals.earnings),t("#renewals-compare").addClass(a.renewals.compare.classes),t("#renewals-compare span").html(a.renewals.compare.percentage+s).removeClass().addClass(a.renewals.compare.classes)),t("#subscriptions").length&&(t("#subscriptions").html(a.subscriptions.number.count),t("#subscriptions-compare").addClass(a.subscriptions.number.compare.classes),t("#subscriptions-compare span").html(a.subscriptions.number.compare.percentage+s).removeClass().addClass(a.subscriptions.number.compare.classes),t("#recurring-revenue").html(a.subscriptions.earnings.total),t("#recurring-revenue-30").html(a.subscriptions.earnings30)),t("#discounts").html(a.discounts.now.amount),t("#discounts-count").html(a.discounts.now.count),t("#discounts-compare").addClass(a.discounts.compare.classes),t("#discounts-compare span").html(a.discounts.compare.percentage+s).removeClass().addClass(a.discounts.compare.classes),t("#commissions").length&&(t("#commissions").html(a.commissions.count),t("#commissions-amount").html(a.commissions.earnings))},detailResponse:function(e){var a=JSON.parse(e);switch(o.getQueryVariable("metric")){case"revenue":t("#revenue").html(a.earnings.total),t("#revenue-compare").addClass(a.earnings.compare.classes),t("#revenue-compare span").html(a.earnings.compare.percentage+o.compare_temp_2).removeClass().addClass(a.earnings.compare.classes),t(".detail-compare-first").html(a.earnings.compare.total),t("#monthly h2").html(a.earnings.avgmonthly.earnings),t("#new-customers h2").html(a.earnings.avgpercust.current_customers),t("#new-customers span").html("This period"),t(".detail-compare-first").html(a.earnings.compare.total),t("#box-4 .bottom-text span").html(a.earnings.compare.percentage+"%")}o.doLineChart(a.lineChart),t(".edd-metrics-chart-wrapper #circleG").remove()},detailResponse_2:function(e){var a=JSON.parse(e);switch(o.getQueryVariable("metric")){case"revenue":t("#revenue-6mocompare").addClass(a.earnings.detail.sixmoago.classes),t("#revenue-6mocompare span").html(a.earnings.detail.sixmoago.compare+o.compare_temp_2).removeClass().addClass(a.earnings.detail.sixmoago.classes),t(".detail-compare-second").html(a.earnings.detail.sixmoago.total),t(".detail-compare-third").html(a.earnings.detail.twelvemoago.total),t("#revenue-12mocompare").addClass(a.earnings.detail.twelvemoago.classes),t("#revenue-12mocompare span").html(a.earnings.detail.twelvemoago.compare+o.compare_temp_2).removeClass().addClass(a.earnings.detail.twelvemoago.classes),t("#earnings-today h2").html(a.earnings.detail.today),t("#earnings-this-month h2").html(a.earnings.detail.this_month),t("#renewal-rate h2").html(a.yearly_renewal_rate.percent+"%"),t("#yearly-renewal-compare span").html("Last "+a.yearly_renewal_rate.period+" days"),t("#box-5 .bottom-text span").html(a.earnings.detail.sixmoago.compare+"%"),t(".detail-compare-second").html(a.earnings.detail.sixmoago.total),t(".detail-compare-third").html(a.earnings.detail.twelvemoago.total)}o.doDownloadChart(a.pieChart),o.doGatewayChart(a.earnings.gateways)},getQueryVariable:function(e){for(var a=r.location.search.substring(1).split("&"),s=0;s<a.length;s++){var t=a[s].split("=");if(t[0]==e)return t[1]}return!1},doLineChart:function(e){o.lineChart&&o.lineChart.destroy();var a={labels:e.labels,datasets:[{label:o.revenue,fill:!0,lineTension:0,backgroundColor:"#edfbed",borderColor:"#009900",borderWidth:3,borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"round",pointBorderColor:"#009900",pointBackgroundColor:"#fff",pointBorderWidth:3,pointHoverRadius:5,pointHoverBackgroundColor:"#009900",pointHoverBorderColor:"#009900",pointHoverBorderWidth:3,pointRadius:5,pointHitRadius:10,data:e.earnings,spanGaps:!1}]},s=n.getElementById("metrics-line-chart"),t=n.getElementById("metrics-line-chart-tiny");null!==s&&(o.lineChart=new Chart(s,{type:"line",data:a,options:{scales:{xAxes:[{display:!1,stacked:!0}]}}})),null!==t&&(a.datasets[0].borderWidth=2,a.datasets[0].pointBorderWidth=2,a.datasets[0].pointHoverRadius=3,a.datasets[0].pointHoverBorderWidth=2,a.datasets[0].pointRadius=3,o.lineChart=new Chart(t,{type:"line",data:a,options:{scales:{xAxes:[{display:!1,stacked:!0}]}}}))},doDownloadChart:function(e){o.downloadChart&&o.downloadChart.destroy();var a={labels:e.labels,datasets:[{label:o.downloads,data:e.earnings,backgroundColor:["#225378","#1695A3","#1fa739","#EB7F00","#EB4B4D","#EBA945","#663300","#79EB65"],hoverBackgroundColor:["#225378","#1695A3","#1fa739","#EB7F00","#EB4B4D","#EBA945","#663300","#79EB65"]}]},s=n.getElementById("metrics-piechart-by-download");o.downloadChart=new Chart(s,{type:"pie",data:a})},doGatewayChart:function(e){o.gatewayChart&&o.gatewayChart.destroy();var a={labels:e.labels,datasets:[{label:o.downloads,data:e.earnings,backgroundColor:["#225378","#1695A3","#1fa739","#EB7F00","#EB4B4D","#EBA945","#663300","#79EB65"],hoverBackgroundColor:["#225378","#1695A3","#1fa739","#EB7F00","#EB4B4D","#EBA945","#663300","#79EB65"]}]},s=n.getElementById("metrics-piechart-by-gateway");o.gatewayChart=new Chart(s,{type:"pie",data:a})}};jQuery(n).ready(o.init)}(window,document,jQuery);